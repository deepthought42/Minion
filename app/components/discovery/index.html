<div controller="WorkManagementCtrl" class="content">
<!--  <button ng-show="isStarted"
          class="btn btn-danger col-xs-12"
          ng-click="stopMappingProcess('account_key_here')">
      Stop!
  </button>
-->

	<div class="secondary-nav vertical__center__int" >
	  <div class="col-md-2 col-sm-4">
			<button class="btn btn--green pull-left" ng-click="startMappingProcess()" ng-disabled="isStarted || failing_tests>0">Start Discovery</button>
	  </div>
		<div class="col-md-10 col-sm-8">
	  </div>
	</div>

	<div class="test-labels">
		<div class="col-xs-2">
		  Status
		</div>
		<div class="col-xs-6">
		  Test Title
		</div>
		<div class="col-xs-2">
		  Time (ms)&nbsp;<i class="fa fa-sort"></i>
		</div>
		<div class="col-xs-2">
		  Date Discovered&nbsp;<i class="fa fa-sort"></i>
		</div>
	</div>

	<div class="test-container">
		<div class="empty__state vertical__center" ng-show="waitingOnTests">
			<div style="text-align:center; margin: 0px auto;">
				<i class="fa fa-hourglass-half fa-spin fa-3x green fa-fw" aria-hidden="true"></i>
				<span class="sr-only">Running...</span>
			</div>
		</div>
		<div class="empty__state vertical__center" ng-show="!waitingOnTests && tests.length==0">
			<h3>Collect your tests by first running a Discovery.</h3>
			<div style="text-align:center; margin: 0px auto;">
				<button class="btn btn--green btn-lg" ng-click="startMappingProcess()"  ng-disabled="isStarted || failing_tests>0">
					Start Discovery
				</button>
			</div>
		</div>
		<div class="test" ng-repeat="test in tests" ng-show="!waitingOnTests && tests.length>0">
			<div class="test__profile vertical__center__int" >
			  <div class="col-xs-2 test__status text--shadow">
			   	<div class="row no-gutter">
					 	<div class="col-xs-6 btn--green select__neutral status vertical__center__int">
						 	<div class="" ng-click="updateCorrectness(test, true, $index)">
						   	<i class="fa fa-check status--symbol white"
							   	 style="{{test.correct ? 'color:green' : 'color:#bfbfbf'}}"></i>
						   	<br/>
						   	Correct
							</div>
						</div>
						<div class="status col-xs-6 btn--red select__neutral vertical__center__int">
							<div class="" ng-click="updateCorrectness(test, false, $index)">
								<i  class="fa fa-times status--symbol white"
									style="{{!test.correct && test.correct != null ? 'color:red' : 'color:#bfbfbf'}}"></i>
								<br/>
								Incorrect
							</div>
						</div>
				  </div>
			  </div>

			  <div class="col-xs-6 test__title" ng-click="toggleTestDataVisibility(test, test.path.path[0])">
					<div class="row">
						<div class="col-xs-12" ng-show="!test.show_test_name_edit_field">
							<h2>{{test.name || "Test #"+($index+1)}}</h2>
							<i class="fa fa-pencil edithover" ng-click="test.show_test_name_edit_field=true"></i>
						</div>
						<div ng-show="test.show_test_name_edit_field">
							<input type="text" ng-model="new_name" ng-value="test.name" />
							<i class="fa fa-plus" ng-click="setTestName(test, new_name)"
								 ng-show="!test.show_waiting_icon"></i>
							<i class="fa fa-hourglass-half fa-spin fa-3x green fa-fw"
								  ng-show="test.show_waiting_icon" aria-hidden="true"></i>
						</div>
					</div>
			  </div>
			  <div class="col-xs-2" ng-click="toggleTestDataVisibility(test, test.path.path[0])">
					{{test.runTime}} ms
			  </div>
			  <div class="col-xs-2" ng-click="toggleTestDataVisibility(test, test.path.path[0])">
					{{ test.time_discovered || "Unknown"}}
			  </div>
			</div>

			<div ng-show="test.visible">
				<div class="test__path vertical__center__int" ng-click="visible_tab='nodedata'+$index">
				  <div ng-repeat="node in test.path.path" class="path-node-container" ng-click="setCurrentNode(node)">
				    <div ng-show="node.screenshot" class="path-node path-page"
						     uib-tooltip="{{node.url}}">
						  <img src="{{node.screenshot}}" class="path-node-image"/>
					  </div>
					 	<div ng-show="node.type == 'PageElement'" class="path-node path-element vertical__center">
							<span class="" uib-tooltip="node.xpath" >
								{{node.name}}
							</span>
			  		</div>
					  <div ng-show="node.type == 'Action'" class="path-node path-action vertical__center">
							<span ng-show="node.name=='click'">
						  	<i class="fa fa-mouse-pointer fa-2x icon" uib-tooltip="node.name"></i>
							</span>
							<span ng-show="node.name=='doubleClick'">
								<i class="fa fa-mouse-pointer fa-2x icon" uib-tooltip="node.name" ></i>
								<div class=”doubleclick” >x2</div>
							</span>
							<span ng-show="node.name=='mouseover'">
								<i class="fa fa-hand-pointer-o fa-2x icon" uib-tooltip="node.name"></i>
							</span>
							<span ng-show="node.name=='scroll'">
								<i class="fa fa-arrows-v fa-2x icon" uib-tooltip="node.name"></i>
							</span>
							<span ng-show="node.name=='sendKeys'">
								<i class="fa fa-i-cursor fa-2x icon" uib-tooltip="node.name"></i>
							</span>
					  </div>
					  <div class="path-bar">
					  </div>
					</div>
					<div class="path-node-container" ng-click="setCurrentNode(test.result);visible_tab='nodedata'+$index">
					  <div  ng-show="test.result.screenshot" class="path-node">
						  <img src="{{test.result.screenshot}}" class="path-node-image"
							 		 uib-tooltip="{{test.result.url}}"/>
					  </div>
					</div>
			  </div>

				<div class="test__groups vertical__center__int no-gutter">

					<div class="col-md-1 col-sm-1 ">
						<h4>Groups: </h4>
					</div>
					<div class="col-md-3 col-sm-5 ">
						<div class="input-group">
							<input type="text" class="form-control pull-right" ng-model="group.name" placeholder="Feature, Smoke, etc." aria-describedby="basic-addon2">
							<span class="input-group-addon btn--gray" ng-click="addGroup(test, group)" id="basic-addon2"><i class="fa fa-plus"></i></span>
						</div>
					</div>
					<div class="col-md-8 col-sm-6 ">
						<div class="group__tag"
								 ng-repeat="group in test.groups"
	               data-toggle="tooltip"
	               data-placement="top"
	               title="{{group.description}}">
						  {{group.name}}
							<span ng-click="removeGroup(test, group, $index)">
								<i class="remove__group fa fa-times"></i>
							</span>
						</div>
					</div>
			</div>
		  <div class="test__info" ng-show="test.visible">
				<ul class="nav nav-tabs" id="myTab" role="tablist">
					<li class="nav-item" ng-click="visible_tab='nodedata'+$index">
						<a class="nav-link active" ng-class="{active: visible_tab=='nodedata'+$index}" id="node-data-tab" data-toggle="tab" role="tab" aria-controls="nodedata" aria-expanded="true" >
								Node Data
						</a>
					</li>
				</ul>
				<div class="tab-content">
					<div class="tab-pane active node__data" id="{{'nodedata'+$index}}"
					 		 aria-labelledby="node-data-tab"
							 ng-show="visible_tab=='nodedata'+$index">
						<div class="node__data">
							<div class="col-sm-12" ng-show="current_node.type=='Page'">

								<div class="col-sm-4 col-xs-12 page-container">
									<img type="button" class="path-node-image" data-toggle="modal" data-target="#exampleModal" src="{{current_node.screenshot}}" class="path-node-image" />
								</div>

								<div class="col-sm-8 col-xs-12">
									<div class="key--value row">
										<div class="col-xs-3 data__key">
										 Landable:&nbsp;&nbsp;
										</div>
										<div class="col-xs-9 data__value">
										 {{current_node.landable}}
										</div>
									</div>
									<div class="key--value row">
										<div class="col-xs-3 data__key">
											URL:&nbsp;&nbsp;
										</div>
										<div class="col-xs-9 data__value">
											{{current_node.url}}
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-12" ng-show="current_node.type=='PageElement'">
								<div class="pull-right col-sm-4" ng-show="current_node.screenshot" >
									<img src="{{current_node.screenshot}}" style="width: 100px; height:100px" uib-tooltip="{{current_node.url}}" />
								</div>
									<div class="row node__title">
										<h4>Element</h4>
									</div>
								 	<div class="key--value row">
										<div class="col-sm-3 data__key no-padding">
										  Tag type:&nbsp;&nbsp;
										</div>
										<div class="col-sm-9 data__value no-padding" style="text-transform:capitalize !important;">
										  {{current_node.name}}
										</div>
								 	</div>
									<div class="key--value row">
										<div class="col-sm-3 data__key no-padding">
										  Xpath:&nbsp;&nbsp;
										</div>
										<div class="col-sm-9 data__value no-padding">
										  {{current_node.xpath}}
										</div>
								  </div>
								 	<div class="key--value row">
										<div class="col-sm-3 data__key">
									  	CSS:&nbsp;&nbsp;
										</div>
										<div class="col-sm-9 data__value" ng-repeat="(key, value) in current_node.cssValues">
											{{key}} -           {{value}}
										</div>
								 	</div>
								 	<div class="key--value row">
										<div class="col-sm-3 data__key">
									 		Attributes:&nbsp;&nbsp;
										</div>

										<div class="col-sm-9 data__value" ng-repeat="attribute in current_node.attributes">
											{{attribute.name}} - {{attribute.vals}}
										</div>
								 	</div>
								 	<div class="key--value row">
										<div class="col-sm-3 data__key">
									 		Text:&nbsp;&nbsp;
										</div>

										<div class="col-sm-9 data__value">
									 		{{current_node.text}}
										</div>
								 	</div>
							</div>
							<div class="" ng-show="current_node.type=='Action'">
								<div class="row node__title">
									<h4>Action</h4>
								</div>
								<div class="key--value row">
									<div class="col-sm-3 data__key">
									 	Name:&nbsp;&nbsp;
									</div>
									<div class="col-sm-9 data__value">
									 {{current_node.name}}
									</div>
								</div>
								<div class="key--value row">
									<div class="col-sm-3 data__key">
										Value:&nbsp;&nbsp;
									</div>
									<div class="col-sm-9 data__value">
									 {{current_node.value}}
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
  	</div>
	</div>
</div>
