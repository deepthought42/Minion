<div class="content">
<!--  <button ng-show="isStarted"
          class="btn btn-danger col-xs-12"
          ng-click="stopMappingProcess('account_key_here')">
      Stop!
  </button>
-->

  <div class="row">
    <div class="col-md-12 error__message" ng-repeat="error in errors track by $index">
      {{error.message}}
    </div>
  </div>

	<div class="secondary-nav vertical__center__int" >
  	<div class="flex-auto">
			<div class="input-group search">
		 		<span class="input-group-addon"><i class="fa fa-search"></i></span>
					<input type="text" class="form-control pull-right" ng-model="searchText" placeholder="Search Tests" aria-describedby="search">
			</div>
		</div>
		<div class="stats__container text-right" >
			<div class="flex-none stats__bar">
				<div class="stat_key_value">
					<!-- /.dropdown -->
					<div class="stat_key">
						Discovery Start
					</div>
					<div class="stat_value">
						{{(current_domain.lastDiscoveryStartedAt || '00:00') | date : 'M/dd/yy h:mm a'}}
					</div>
				</div>
		  </div>
			<div class="flex-none stats__bar">
				<div class="stat_key_value">
					<!-- /.dropdown -->
					<div class="stat_key">
						Last Test Found
					</div>
					<div class="stat_value">
						{{((Date.now() - (tests | orderBy:{'lastRunTimestamp':true})[tests.length-1].lastRunTimestamp) || '00:00') | date : 'h:mm'}} hrs ago
					</div>
				</div>
			</div>
			<div class="flex-none stats__bar">
				<div class="stat_key_value">
					<!-- /.dropdown -->
					<div class="stat_key">
						Total Runtime
					</div>
					<div class="stat_value">
						{{((current_domain.lastRunTimestamp - current_domain.lastDiscoveryStartedAt )/1000 | date : 'h:mm')  || '00:00'}}
                        hrs
					</div>
				</div>
			</div>
			<div class="flex-none stats__bar">
				<div class="stat_key_value">
					<!-- /.dropdown -->
					<div class="stat_key">
						Total Tests
					</div>
					<div class="stat_value">
						{{tests.length || 0}} tests
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="secondary-nav vertical__center__int" >
	  <div class="col-sm-12" ng-show="!isStarted" >
			<button class="btn btn--primary pull-left" ng-click="startDiscovery()" id="start_discovery_button">
				Start Discovery
			</button>
    </div>

    <div class="col-sm-12" ng-if="isStarted">
			<div class="pull-left">
				Running...
         <i class="fa fa-circle-o-notch fa-spin fa-2x green fa-fw" aria-hidden="true"></i>
			</div>
	  </div>
	</div>

	<div class="test-labels">
		<div class="status__title test__status__frame">
		  Status
		</div>
		<div class="flex-auto test_functions">
		  Test Title
		</div>
		<div class="flex-initial time_stats">
		  Time (minutes)
		</div>
		<div class="flex-initial time_stats">
		  Date Discovered
		</div>
        <div class="flex-none accordion-flex">
		</div>
	</div>

	<div class="test-container">

		<div class="empty__state vertical__center_empty_state_discovery" ng-show="!isStarted && !waitingOnTests && tests.length==0">
			<div>
        <h2>Collect your tests by first running a Discovery.</h2>
      </div>
	    <div>
        <button class="btn btn--primary btn-lg" ng-click="startDiscovery()">
          Start Discovery
        </button>
      </div>
		</div>
    <div class="empty__state vertical__center_empty_state_busy" ng-if="(isStarted && tests.length==0) || waitingOnTests">
      <div style="text-align:center; margin: 0px auto;">
        <i class="fa fa-circle-o-notch fa-spin fa-3x green fa-fw" aria-hidden="true"></i>
				<br><br><br>
				<h2>Your tests are loading. Please stand by.</h2>
				<p class="empty__state__p">This process may take a while. You may want to leave this window open and go grab a coffee.<br><br>Please contact <a href="mailto:support@qanairy.com?subject=Excessive%20Load%20Times">support@qanairy.com</a> if this message is still active after 24 hrs.<br>If you would like to see this run faster contact us about a paid subscription.</p>
      </div>
    </div>

    <div class="test" ng-repeat="test in tests track by test.key" ng-show="tests.length>0">

			<div class="test__profile vertical__left__profile" ng-click="setTestIndex($index);visible_tab='nodedata'+$index">
			  <div class="test__status test__profile_stretch flex-none text--shadow" >
			   	<div class="row test__status__frame" id="{{'test'+$index+'_status'}}">
						<div class="col-xs-12 test__status" ng-show="test.waitingOnStatusChange">
							<i class="fa fa-circle-o-notch fa-spin fa-3x green fa-fw" aria-hidden="true"></i>
						</div>
					 	<div class="col-xs-6 btn--green select__neutral status-passing discovery_status" ng-show="!test.waitingOnStatusChange" ng-click="updateCorrectness(test, true, $index)">
						 	<div class="" >
								Passing
								<br />
								<i class="fa fa-check discovery--status--symbol white"
							   	 style="{{test.correct ? 'color:green' : 'color:#bfbfbf'}}"></i>
							</div>
						</div>
						<div class="discovery_status status-failing col-xs-6 btn--red select__neutral " ng-show="!test.waitingOnStatusChange" ng-click="updateCorrectness(test, false, $index)">
							<div class="" >
									Failing
								<br />
								<i  class="fa fa-times discovery--status--symbol white"
									style="{{!test.correct && test.correct != null ? 'color:red' : 'color:#bfbfbf'}}"></i>
							</div>
						</div>
				  </div>
			  </div>

        <div class="flex-auto test_functions test__profile_stretch" ng-click="toggleTestDataVisibility(test, $index)" ng-if="!test.show_test_name_edit_field">
					<div class="" ng-show="!test.show_test_name_edit_field">
						<h4>
              {{test.name || "Test #"+($index+1)}}
            </h4>
						<i class="fa fa-pencil edithover" ng-click="test.show_test_name_edit_field = true" ></i>
					</div>
				</div>
        <div class="test_name flex-auto time_stats test__profile_stretch" ng-if="test.show_test_name_edit_field">
					<div class="row">
						<div class="flex-auto fifteen_left">
							<div class="">
								<input class="form-control title__edit" type="text" ng-model="new_name" ng-value="test.name" ng-trim="false"/>
							</div>
						</div>
						<div class="flex-none test_name_edit fifteen_right">
							<div class="title__edit__buttons btn--secondary" ng-click="cancelEditingTestName(test)" ng-show="!test.show_waiting_icon">Cancel</div><div class="title__edit__buttons btn--primary " ng-click="setTestName(test, new_name)" ng-show="!test.show_waiting_icon">Save</div>
							<div class="" ng-show="test.show_waiting_icon">
								<i class="fa fa-circle-notch fa-spin fa-2x green fa-fw"  aria-hidden="true"></i>
							</div>
						</div>
					</div>
				</div>
			  <div class="flex-initial time_stats test__profile_stretch" ng-click="toggleTestDataVisibility(test, $index)">
					{{test.runTime | date: 'm'}}:{{test.runTime | date: 'ss'}} m
			  </div>
			  <div class="flex-initial time_stats test__profile_stretch" ng-click="toggleTestDataVisibility(test, $index)">
					{{( test.lastRunTimestamp | date : 'MM/dd/yy h:mm a')  || "Unknown"}}
			  </div>
        <div class="flex-none accordion-flex test__profile_stretch" ng-click="toggleTestDataVisibility(test, $index)">
          <div class="accordion" aria-label="open/close accordion">
            <i class="fa fa-2x" ng-class="test.visible ? 'fa-angle-down' : 'fa-angle-right'" />
          </div>
        </div>
			</div>


	     <div class="row test__path" ng-show="test.visible"  >
          <div class="col-sm-12 path__title">
              <h5>Test Path</h5>
          </div>
          <div class="col-xs-12 vertical__left__int" ng-click="visible_tab='nodedata'+$index" id="{{'test'+$index+'_data'}}">
              <div ng-repeat="node in test.path.path track by $index" class="path-node-container vertical__center__int" ng-click="setCurrentNode(node)" tooltip-placement="top">
                <div ng-if="node.browser_screenshots[default_browser]" class="path-page path-node" ng-class="current_node[test_idx]==node ? 'active' : ''" >
                  <img src="{{node.browser_screenshots[default_browser]}}" class="path-node-image"/>
                </div>
                <div ng-if="node.type == 'PageElement'" class="path-node path-element vertical__center__int" tooltip-placement="top" ng-class="current_node[test_idx]==node ? 'active' : ''">
                  <span class="" >
                    {{node.name}}
                  </span>
                </div>
                <div ng-if="node.type == 'Action'" class="path-node path-action vertical__center__int" tooltip-placement="top" ng-class="current_node[test_idx]==node ? 'active' : ''">
                  <span ng-if="node.name=='click'" class="vertical__center__int">
                  <i class="fa fa-mouse-pointer fa-2x"></i>
                  </span>
                  <span ng-if="node.name=='doubleClick'" class="vertical__center__int">
                      <i class="fa fa-mouse-pointer fa-2x"></i>
                      <div class=”doubleclick” >
                          x2
                      </div>
                  </span>
                  <span ng-if="node.name=='mouseover'" class="vertical__center__int">
                      <i class="fa fa-hand-pointer-o fa-2x"></i>
                  </span>
                  <span ng-if="node.name=='scroll'" class="vertical__center__int">
                      <i class="fa fa-arrows-v fa-2x"></i>
                  </span>
                  <span ng-if="node.name=='sendKeys'" class="vertical__center__int">
                      <i class="fa fa-i-cursor fa-2x"></i>
                  </span>
              </div>
              <div class="path-bar">
              </div>
            </div>
            <div class="path-node-container vertical__center__int" ng-click="setCurrentNode(test.result, $index)" >
              <div ng-if="test.path.path.length != 1 && test.result.browser_screenshots[default_browser]" class="path-page path-node" ng-class="current_node[test_idx]==test.result ? 'active' : ''">
                <img src="{{test.result.browser_screenshots[default_browser]}}" class="path-node-image" tooltip-placement="top"/>
              </div>
            </div>
          </div>
      </div>


            <div class="row test__data" ng-if="test.visible">
                <div class="col-xs-12 test__info" >
                    <div class="row">
                        <div class="col-xs-8">
                            <div class="row node__data" id="{{'nodedata'+$index}}" ng-show="visible_tab=='nodedata'+$index">
                                <div class="col-sm-12" ng-show="current_node[$index].type=='Page'">
                                  <div class="row">
                                    <div class="node__title">
                                      <h5>
                                        <span style="">Page -</span>
                                        <a href="{{current_node[$index].url}}">{{current_node[$index].url}}</a>
                                      </h5>
                                    </div>
                                    <div>
                                      <div class="page__image col-xs-2">
                                        <img type="button" class="path-node-image"
                                                data-toggle="modal" data-target="#exampleModal"
                                                src="{{current_node[$index].browser_screenshots[default_browser]}}" class="path-node-image"
                                                ng-click="openPageModal(current_node[$index])" />
                                      </div>
                                      <div class="col-xs-10">
                                        <div class="key--value" ng-if="test.path.path.length > 1">
                                          Page Verification test
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-sm-12" ng-show="current_node[$index].type=='PageElement'">
                                    <div class="row no-gutter">
                                      <div class="node__title">
                                        <h5>
                                          <span>Element</span> - {{current_node[$index].name}}
                                        </h5>
                                      </div>
                                        <div class="col-sm-12 col-xs-12">
                                          <div class="key--value">
                                            <div class="data__key">
                                             Xpath
                                            </div>
                                            <div class="data__value">
                                             {{current_node[$index].xpath}}
                                            </div>
                                          </div>
                                        </div>
                                        <div class="col-sm-12 col-xs-12">
                                          <div class="key--value">
                                            <div class="data__key">
                                              Text
                                            </div>
                                            <div class="data__value">
                                              {{current_node[$index].text}}
                                            </div>
                                          </div>
                                        </div>
                                        <div class="col-sm-4 col-xs-12">
                                          <div class="key--value">
                                            <div class="data__key">
                                              CSS
                                            </div>
                                            <div class="data__value" ng-repeat="(key, value) in current_node[$index].cssValues track by key">
                                              {{key}}:           {{value}};
                                            </div>
                                          </div>
                                        </div>
                                        <div class="col-sm-8 col-xs-12">
                                            <div class="key--value">
                                                <div class="data__key">
                                                    Attributes
                                                </div>
                                                <div class="row attribute__data__value" ng-repeat="attribute in current_node[$index].attributes track by attribute.key">
                                                    <div class="col-sm-5 attribute__key">
                                                        {{attribute.name}}
                                                    </div>
                                                    <div class="attribute_value col-sm-7 pull-right">
  	                                                  <div class="row" ng-repeat="value in attribute.vals track by $index">
  																											<div class="col-sm-12" style="text-align:right">
  	                                                      {{value}}
  																											</div>
  	                                                  </div>
  																									</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12" ng-show="current_node[$index].type=='Action'">
                                    <div class="row no-gutter">
                                      <div class="col-xs-12 node__title">
                                            <h5><span style="">Action</span> -  {{current_node[$index].name != 'sendKeys' ? current_node[$index].name : 'Type'}}</h5>
                                        </div>
                                        <div class="col-xs-12">
                                            <div class="key--value" ng-show="current_node[$index].value || current_node[$index].name=='sendKeys'">
                                                <div class="data__key">
                                                    Value
                                                </div>
                                                <div class="data__value">
                                                    {{current_node[$index].value}}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-4 test__groups">
                          <div class="row">
                            <div class="col-sm-12 " id="group_label">
                                <h5>Groups</h5>
                            </div>
                            <div class="col-sm-8">
                              <div class="input-group groups_input_padding">
                                <input type="text" class="form-control pull-right" ng-model="group.name" placeholder="Smoke, Login Form, etc." aria-describedby="basic-addon2" maxlength="20">
                                <span class="input-group-addon btn--gray" ng-click="addGroup(test, group)" id="basic-addon2">
                                    <i class="fa fa-plus"></i>
                                </span>
                              </div>
                            </div>
                            <div class="col-sm-4">
                            </div>
                            <div class="col-sm-12">
                                <div class="group__tag"
                                         ng-repeat="group in test.groups track by group.key"
                                         data-toggle="tooltip"
                                         data-placement="top"
                                         title="{{group.description}}">
                                    {{group.name}}
                                    <span ng-click="removeGroup(test, group, $index)">
                                        <i class="remove__group fa fa-times"></i>
                                    </span>
                                </div>
                            </div>
                          </div>
                        </div>
                    </div>
                </div>
            </div>
	</div>

  <onboarding-popover enabled="discoveryOnboardingEnabled" steps="discoveryOnboardingSteps" step-index="discoveryOnboardingIndex"></onboarding-popover>
  <onboarding-popover enabled="discoveryRunningOnboardingEnabled" steps="discoveryRunningOnboardingSteps" step-index="discoveryRunningOnboardingIndex"></onboarding-popover>
  <onboarding-popover enabled="discoveredTestOnboardingEnabled" steps="discoveredTestOnboardingSteps" step-index='discoveredTestOnboardingIndex'></onboarding-popover>
  <onboarding-popover enabled="testVerificationOnboardingEnabled" steps="testVerificationSteps" step-index='testVerificationOnboardingIndex'></onboarding-popover>
