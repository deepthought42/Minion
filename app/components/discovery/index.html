<div class="content">
<!--  <button ng-show="isStarted"
          class="btn btn-danger col-xs-12"
          ng-click="stopMappingProcess('account_key_here')">
      Stop!
  </button>
-->

  <div class="row">
    <div class="col-md-12 error__message" ng-repeat="error in errors track by $index">
      {{error.message}}
    </div>
  </div>

	<div class="secondary-nav vertical__center__int" >
  	<div class="flex-auto">
			<div class="col-sm-12" ng-show="!isStarted" >
				<button class="btn btn--primary pull-left" ng-click="startDiscovery()" id="start_discovery_button">
					Start Discovery
				</button>
			</div>

			<div class="col-sm-12 running_status" ng-if="isStarted">
        <div class="col-sm-3 pull-left">
          <md-progress-linear md-mode="determinate" value="{{(discovery_status.examinedPathCount/discovery_status.totalPathCount)*100 || 0 }}"></md-progress-linear>
        </div>
        <div class="pull-left">
  				Running...{{(discovery_status.examinedPathCount/discovery_status.totalPathCount)*100 || 0 | number:0 }} %
           <i class="fa fa-circle-o-notch fa-spin fa-2x green fa-fw" aria-hidden="true"></i>
  			</div>
			</div>
		</div>
			<div class="flex-auto pull-right right-main-nav ">
				<div class="input-group search">
					<span class="input-group-addon"><i class="fa fa-search"></i></span>
						<input type="text" class="form-control pull-right" ng-model="searchText" placeholder="Search Tests" aria-describedby="search">
				</div>
		  </div>
	</div>

	<div class="test-labels-container">
		<div class="test-labels">
			<div class="status__title test__status__frame">
				Status
			</div>
			<div class="flex-auto test_functions">
				Test Title
			</div>
			<div class="flex-initial time_stats text-right">
				Time (minutes)
			</div>
			<div class="flex-initial date_stats text-right">
				Date Discovered
			</div>
					<div class="flex-none accordion-flex">
			</div>
		</div>
	</div>

	<div class="test-container">

		<div class="empty__state vertical__center_empty_state_discovery" ng-show="!isStarted && !waitingOnTests && tests.length==0">
			<div>
        <h2>Collect your tests by first running a Discovery.</h2>
      </div>
	    <div>
        <button class="btn btn--primary btn-lg" ng-click="startDiscovery()">
          Start Discovery
        </button>
      </div>
		</div>
    <div class="empty__state vertical__center_empty_state_busy" ng-if="(isStarted && tests.length==0) || waitingOnTests">
      <div style="text-align:center; margin: 0px auto;">
        <i class="fa fa-circle-o-notch fa-spin fa-3x green fa-fw" aria-hidden="true"></i>
				<br><br><br>
				<h2>Your tests are loading. Please stand by.</h2>
				<p class="empty__state__p">
          This process may take a while. You may want to leave this window open and go grab a coffee.<br><br>Please contact <a href="mailto:support@qanairy.com?subject=Excessive%20Load%20Times">support@qanairy.com</a> if this message is still active after 24 hrs.<br>If you would like to see this run faster contact us about a paid subscription.
        </p>
      </div>
    </div>

    <div class="test" ng-repeat="test in (filteredTests = tests) | filter:searchText | orderBy:'lastRunTimestamp' track by test.key " ng-show="tests.length>0">
			<div class="test__profile vertical__left__profile" ng-click="setTestIndex($index);visible_tab='nodedata'+$index">
			  <div class="test__status test__profile_stretch flex-none text--shadow" >
			   	<div class="row test__status__frame" id="{{'test'+$index+'_status'}}">
						<div class="col-xs-12 test__status" ng-show="test.waitingOnStatusChange">
							<i class="fa fa-circle-o-notch fa-spin fa-3x green fa-fw" aria-hidden="true"></i>
						</div>
					 	<div class="col-xs-6 status-passing btn--green discovery_status discovery_status_border" ng-show="!test.waitingOnStatusChange" ng-click="updateCorrectness(test, 'PASSING', $index)">
						 	<div class="" >
								Passing
								<br />
								<i class="fa fa-check discovery--status--symbol white"
							   	 style="{{test.status == "PASSING" ? 'color:green' : 'color:#bfbfbf'}}"></i>
							</div>
						</div>
						<div class="discovery_status status-failing col-xs-6 btn--red " ng-show="!test.waitingOnStatusChange" ng-click="updateCorrectness(test, 'FAILING', $index)">
							<div class="" >
									Failing
								<br />
								<i  class="fa fa-times discovery--status--symbol white"
									style="{{!test.status == "FAILING" && test.status != null ? 'color:red' : 'color:#bfbfbf'}}"></i>
							</div>
						</div>
				  </div>
			  </div>

        <div class="flex-auto test__title test_functions test__profile_stretch" ng-click="toggleTestDataVisibility(test, $index)" ng-if="!test.show_test_name_edit_field">
					<div class="" ng-show="!test.show_test_name_edit_field">
						<h5 class="test__title">
              {{test.name || "Test #"+($index+1)}}
            </h5>
						<i class="fa fa-pencil edithover" ng-click="test.show_test_name_edit_field = true" ></i>
					</div>
				</div>
        <div class="test_name flex-auto time_stats test__profile_stretch" ng-if="test.show_test_name_edit_field">
					<div class="row">
						<div class="flex-auto">
							<div class="">
								<input class="form-control title__edit" type="text" ng-model="new_name" ng-value="test.name" ng-trim="false"/>
							</div>
						</div>
						<div class="flex-none test_name_edit">
							<div class="title__edit__buttons margin_fifteen_left btn--secondary" ng-click="cancelEditingTestName(test)" ng-show="!test.show_waiting_icon">
                Cancel
              </div>
              <div class="title__edit__buttons margin_fifteen_left btn--primary " ng-click="setTestName(test, new_name)" ng-show="!test.show_waiting_icon">
                Save
              </div>
							<div class="" ng-show="test.show_waiting_icon">
								<i class="fa fa-circle-notch fa-spin fa-2x green fa-fw"  aria-hidden="true"></i>
							</div>
						</div>
					</div>
				</div>
			  <div class="flex-initial text-right time_stats test__profile_stretch" ng-click="toggleTestDataVisibility(test, $index)">
					{{test.runTime | date: 'm'}}:{{test.runTime | date: 'ss'}} m
			  </div>
			  <div class="flex-initial text-right date_stats test__profile_stretch" ng-click="toggleTestDataVisibility(test, $index)">
					{{( test.lastRunTimestamp | date : 'MM/dd/yy h:mm a')  || "Unknown"}}
			  </div>
        <div class="flex-none accordion-flex test__profile_stretch" ng-click="toggleTestDataVisibility(test, $index)">
          <div class="accordion" aria-label="open/close accordion">
            <i class="fa fa-2x" ng-class="test.visible ? 'fa-angle-down' : 'fa-angle-right'" ></i>
          </div>
        </div>
			 </div>
	     <div class="row no-gutter test__dropdown" ng-show="test.visible"  >
				 <div class="col-sm-12">
						<div class="tabs tabs-style-linemove">
							<nav class="path_tabs">
								<ul>
									<li class="tabs-style" ng-click="visible_test_nav1='section-linemove-1'" ng-class="visible_test_nav1=='section-linemove-1' ? 'tabs-style_active' : ''">
                    <a>
                      <h5>
                        <i class="fa test_tab_icons fa-map-signs"/>
                        &nbsp;  Path
                      </h5>
                    </a>
                  </li>
									<li class="tabs-style" ng-click="visible_test_nav1='section-linemove-2'" ng-class="visible_test_nav1=='section-linemove-2' ? 'tabs-style_active' : ''">
                    <a>
                      <h5>
                        <i class="fa test_tab_icons fa-object-group"/>
                        &nbsp;  Groups
                      </h5>
                    </a>
                  </li>
								</ul>
							</nav>
							<div class="content-wrap">
								<div id="section-linemove-1" ng-if="visible_test_nav1=='section-linemove-1'">
									<div class="col-xs-12 test__path vertical__left__int" ng-click="visible_tab='nodedata'+$index" id="{{'test'+$index+'_data'}}">
										<div ng-repeat="node in current_path_objects track by $index" class="path-node-container vertical__center__int" tooltip-placement="top">
                      <div class="node-group path-node-container vertical__center__int"
                           ng-if="node.type == 'PageState'"
                           ng-class="current_node[test_idx]==node ? 'active' : ''"
                           ng-click="setCurrentNode(node, $index)">
                        <div class="path-page path-node">
  					              <img src="{{node.browserScreenshots[0].viewportScreenshot}}" class="path-node-image"/>
  											</div>
                      </div>
                      <div ng-if="node.type == 'PageElement'" class="node-group"
                           ng-class="current_node[test_idx]==node ? 'active' : ''"
                           ng-click="setCurrentNode(node, $index)">
  											<div class="path-node path-element vertical__center__int" tooltip-placement="top">
  												<span class="" >
  													{{node.name}}
  												</span>
  											</div>
                        <div class="path-bar">
                        </div>
  											<div class="path-node path-action vertical__center__int" tooltip-placement="top">
  												<span ng-if="current_path_objects[$index+1].name=='click'" class="vertical__center__int">
							              <i class="fa fa-mouse-pointer fa-2x"></i>
  												</span>
  												<span ng-if="current_path_objects[$index+1].name=='doubleClick'" class="vertical__center__int">
														<i class="fa fa-mouse-pointer fa-2x"></i>
														<div class=”doubleclick” >
																x2
														</div>
  												</span>
  												<span ng-if="current_path_objects[$index+1].name=='mouseover'" class="vertical__center__int">
														<i class="fa fa-hand-pointer-o fa-2x"></i>
  												</span>
  												<span ng-if="current_path_objects[$index+1].name=='scroll'" class="vertical__center__int">
														<i class="fa fa-arrows-v fa-2x"></i>
  												</span>
  												<span ng-if="current_path_objects[$index+1].name=='sendKeys'" class="vertical__center__int">
														<i class="fa fa-i-cursor fa-2x"></i>
  												</span>
  											</div>
                      </div>
                      <div ng-if="test.pathKeys.length > 1 && node.type != 'Action'" class="path-bar">
											</div>
										</div>
										<div class="node-group path-node-container vertical__center__int" ng-click="setCurrentNode(getPathObject(test.result.key), 0)" >
											<div ng-if="test.pathKeys.length > 1" class="path-page path-node">
												<img src="{{getPathObject(test.result.key).browserScreenshots[0].viewportScreenshot}}" class="path-node-image" tooltip-placement="top"/>
											</div>
										</div>
									</div>
									<div class="col-sm-12 test__data test_dropdown_bottom_shadow" ng-if="current_node[test_idx].type == 'PageElement'">
										<div class="row">
											<div class="col-sm-6">
												<div class="node__screenshots test__data__box__shadow tabs tabs-style-linemove">
													<div class="content-wrap screenshot-section">
														<div id="section-linemove-1">
															<div class="element__image col-xs-12">
																<h5 class="screenshots_title">
																	Element
                                </h5>
																<img class="path-node-image"
																			data-toggle="modal" data-target="#exampleModal"
																			src="{{current_node[test_idx].screenshot}}" class="path-node-image"/>
  														</div>
  													</div>
  												</div>
													<nav class="col-sm-12">
														<ul class="row browser_tabs">
															<li class="tabs-style2" ng-click="visible_browser_screenshot='chrome'" ng-class="visible_browser_screenshot=='chrome' ? 'tabs-style2_active' : ''">
                                <a>
			                            <i class="fa fa-chrome"></i>
                                  &nbsp;&nbsp;&nbsp;Chrome
                                </a>
															</li>
															<li class="tabs-style2" ng-click="visible_browser_screenshot='firefox'" ng-class="visible_browser_screenshot=='firefox' ? 'tabs-style2_active' : ''">
                                <a>
							                    <i class="fa fa-firefox "></i>
                                  &nbsp;&nbsp;&nbsp;Firefox
                                </a>
                              </li>
														</ul>
													</nav>
  											</div><!-- /tabs -->
  										</div>
  										<div class="col-sm-6">
												<div class="node__data test__data__box__shadow tabs tabs-style-linemove">
													<nav>
														<ul>
															<li class="tabs-style" ng-click="visible_test_nav2='section-linemove-1'" ng-class="visible_test_nav2=='section-linemove-1' ? 'tabs-style_active' : ''">
                                <a>
                                  <h5>Info</h5>
                                </a>
                              </li>
															<li class="tabs-style" ng-click="visible_test_nav2='section-linemove-2'" ng-class="visible_test_nav2=='section-linemove-2' ? 'tabs-style_active' : ''">
                                <a>
                                  <h5>Attributes</h5>
                                </a>
                              </li>
															<li class="tabs-style" ng-click="visible_test_nav2='section-linemove-3'" ng-class="visible_test_nav2=='section-linemove-3' ? 'tabs-style_active' : ''">
                                <a>
                                  <h5>CSS</h5>
                                </a>
                              </li>
														</ul>
													</nav>
													<div class="content-wrap element-tabs">
														<div ng-if="visible_test_nav2=='section-linemove-1'">
															<div class="col-xs-12">
																<div class="key--value">
																	<div class="data__key">
																	  Xpath
																	</div>
																	<div class="data__value">
																	  {{current_node[$index].xpath}}
																	</div>
																</div>
															</div>
															<div class="col-xs-12">
																<div class="key--value">
																	<div class="data__key">
																	  Action
																	</div>
																	<div class="data__value">
                                    {{current_path_objects[current_node_idx+1].name != 'sendKeys' ? current_path_objects[current_node_idx+1].name : 'Type'}}
																	</div>
																</div>
															</div>
															<div class="col-xs-12">
																<div class="key--value" ng-show="current_path_objects[current_node_idx+1].value || current_path_objects[current_node_idx+1].name=='sendKeys'">
																	<div class="data__key">
																		Text Input
																	</div>
																	<div class="data__value">
																		{{current_path_objects[current_node_idx+1].value}}
																	</div>
																</div>
															</div>
															<div class="col-xs-12">
																<div class="key--value">
																	<div class="data__key">
																	  Element Type
																	</div>
																	<div class="data__value">
  																	  {{current_node[$index].name}}
																	</div>
																</div>
															</div>
															<div class="col-xs-12" ng-if="current_path_objects[current_node_idx+1].name=='a'">
																<div class="key--value">
																	<div class="data__key">
																	  Element Link
																	</div>
																	<div class="data__value">
                                    {{current_node[$index].attributes[0].vals[0]}}
																	</div>
																</div>
															</div>
															<div class="col-xs-12">
																<div class="key--value">
																	<div class="data__key">
																		Text
																	</div>
																	<div class="data__value">
																		{{current_node[$index].text}}
																	</div>
																</div>
															</div>
														</div>
														<div id="section-linemove-2" ng-if="visible_test_nav2=='section-linemove-2'">
															<div class="col-xs-12">
																<div class="key--value">
																	<div class="row" ng-repeat="attribute in current_node[$index].attributes track by attribute.key">
																		<div class="col-sm-12 data__key">
																			{{attribute.name}}
																		</div>
																		<div class="col-sm-12 data__value">
																			<div class="row d-inline-block" ng-repeat="value in attribute.values track by $index">
																				<div class="col-sm-12" style="">
																					{{value}}&nbsp;&nbsp;
																				</div>
																			</div>
																		</div>
																	</div>
																</div>
															</div>
														</div>
														<div id="section-linemove-3" ng-if="visible_test_nav2=='section-linemove-3'">
															<div class="col-xs-12">
																<div class="key--value">
                                  <div class="data__value">
                                    width: {{current_node[$index].cssValues['width']}}
                                  </div>
                                  <div class="data__value">
                                    height: {{current_node[$index].cssValues['height']}}
                                  </div>
                                  <div class="data__value">
                                    font-family: {{current_node[$index].cssValues['font-family']}}
                                  </div>
                                  <div class="data__value">
																		position: {{current_node[$index].cssValues['position']}}
																	</div>
																	<div class="data__value">
																		background-color:
																		<span style="background-color:{{current_node[$index].cssValues['color']}}">
																			{{current_node[$index].cssValues['color']}}
																		</span>
																	</div>
																</div>
															</div>
														</div>
													</div><!-- /content -->
												</div><!-- /tabs -->
											</div>
										</div>
									</div>
									<div class="col-xs-12 test__data test_dropdown_bottom_shadow" ng-if="current_node[test_idx].type == 'PageState'">
										<div class="row">
											<div class="col-sm-6">
												<div class="node__screenshots test__data__box__shadow tabs tabs-style-linemove">
													<div class="content-wrap screenshot-section">
														<div class="page__image col-xs-12"  >
															<h5 class="screenshots_title">
                                Page
                              </h5>
                              <div ng-repeat="screenshot_set in current_node[test_idx].browserScreenshots" ng-if="visible_browser_screenshot==screenshot_set.browser">
																<img class="path-node-image page-image screenshots"
																			data-toggle="modal" data-target="#exampleModal"
																			src="{{screenshot_set.viewportScreenshot}}" class="path-node-image"
																			ng-click="openPageModal(screenshot_set.viewportScreenshot)" />
                              </div>
														</div>
						              </div><!-- /content -->
													<nav class="col-sm-12">
														<ul class="row browser_tabs">
															<li class="tabs-style2" ng-click="visible_browser_screenshot='chrome'"
                                  ng-class="visible_browser_screenshot=='chrome' ? 'tabs-style2_active' : ''">
                                <a>
			                            <i class="fa fa-chrome"></i>
                                  &nbsp;&nbsp;&nbsp;Chrome
                                </a>
															</li>
															<li class="tabs-style2" ng-click="visible_browser_screenshot='firefox'"
                                  ng-class="visible_browser_screenshot=='firefox' ? 'tabs-style2_active' : ''">
                                <a>
							                    <i class="fa fa-firefox "></i>
                                  &nbsp;&nbsp;&nbsp;Firefox
                                </a>
                              </li>
														</ul>
													</nav>
											</div><!-- /tabs -->
										</div>
										<div class="col-sm-6">
                      <div class="node__data test__data__box__shadow tabs tabs-style-linemove">
												<div class="col-xs-12">
													<h5 class="info__title">
													  Info
                          </h5>
													<div class="key--value">
														<div class="data__key">
														  URL
														</div>
														<div class="data__value">
														 <a href="{{current_node[$index].url}}" target="_blank">
                               {{current_node[$index].url}}
                             </a>
														</div>
													</div>
												</div>
											</div><!-- /tabs -->
										</div>
									</div>
								</div>
							</div>
							<div id="section-linemove-2" ng-if="visible_test_nav1=='section-linemove-2'">
								<div class="col-xs-12 test__groups test_dropdown_bottom_shadow">
									<div class="row">
										<div class="col-sm-12 " id="group_label">
											<h5>Groups</h5>
										</div>
										<div class="col-sm-12 ">
											<div class="input-group groups_input_padding">
												<input type="text" class="form-control pull-right" ng-model="group.name" placeholder="Smoke, Login Form, etc." aria-describedby="basic-addon2" maxlength="20">
												<span class="input-group-addon btn--gray" ng-click="addGroup(test, group)" id="basic-addon2">
													<i class="fa fa-plus"></i>
												</span>
											</div>
										</div>
										<div class="col-sm-12">
											<div class="group__tag"
													 ng-repeat="group in test.groups track by group.key"
													 data-toggle="tooltip"
													 data-placement="top"
													 title="{{group.description}}">
												{{group.name}}
												<span ng-click="removeGroup(test, group, $index)">
													<i class="remove__group fa fa-times"></i>
												</span>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div><!-- /content -->
					</div><!-- /tabs -->
				</div>
      </div>
	</div>

  <onboarding-popover enabled="discoveryOnboardingEnabled" steps="discoveryOnboardingSteps" step-index="discoveryOnboardingIndex"></onboarding-popover>
  <onboarding-popover enabled="discoveryRunningOnboardingEnabled" steps="discoveryRunningOnboardingSteps" step-index="discoveryRunningOnboardingIndex"></onboarding-popover>
  <onboarding-popover enabled="discoveredTestOnboardingEnabled" steps="discoveredTestOnboardingSteps" step-index='discoveredTestOnboardingIndex'></onboarding-popover>
  <onboarding-popover enabled="testVerificationOnboardingEnabled" steps="testVerificationSteps" step-index='testVerificationOnboardingIndex'></onboarding-popover>
