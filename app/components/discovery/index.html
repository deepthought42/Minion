<div class="content">
<!--  <button ng-show="isStarted"
          class="btn btn-danger col-xs-12"
          ng-click="stopMappingProcess('account_key_here')">
      Stop!
  </button>
-->

  <div class="row">
    <div class="col-md-12 error__message" ng-repeat="error in errors track by $index">
      {{error.message}}
    </div>
  </div>

	<div class="secondary-nav vertical__center__int" >
  	<div class="flex-auto">
			<div class="input-group search">
		 		<span class="input-group-addon">
          <i class="fa fa-search"></i>
        </span>
        <input type="text" class="form-control pull-right" ng-model="searchText" placeholder="Search Tests" aria-describedby="search">
			</div>
		</div>
		<div class="stats__container text-right" >
			<div class="flex-none stats__bar">
				<div class="stat_key_value">
					<!-- /.dropdown -->
					<div class="stat_key">
						Discovery Start
					</div>
					<div class="stat_value">
						{{(current_domain.lastDiscoveryStartedAt || '00:00') | date : 'M/dd/yy h:mm a'}}
					</div>
				</div>
		  </div>
			<div class="flex-none stats__bar">
				<div class="stat_key_value">
					<!-- /.dropdown -->
					<div class="stat_key">
						Last Test Found
					</div>
					<div class="stat_value">
						{{((Date.now().getTime() - (tests | orderBy:{'lastRunTimestamp':true})[tests.length-1].lastRunTimestamp) || '00:00') | date : 'h:mm'}} hrs ago
					</div>
				</div>
			</div>
			<div class="flex-none stats__bar">
				<div class="stat_key_value">
					<!-- /.dropdown -->
					<div class="stat_key">
						Total Runtime
					</div>
					<div class="stat_value">
						{{getTotalRuntime()}}
                        hrs
					</div>
				</div>
			</div>
			<div class="flex-none stats__bar">
				<div class="stat_key_value">
					<!-- /.dropdown -->
					<div class="stat_key">
						Total Tests
					</div>
					<div class="stat_value">
						{{tests.length || 0}} tests
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="tertiary-nav vertical__center__int" >
	  <div class="col-sm-12" ng-show="!isStarted" >
			<button class="btn btn--primary pull-left" ng-click="startDiscovery()" id="start_discovery_button">
				Start Discovery
			</button>
    </div>

    <div class="col-sm-12 running_status" ng-if="isStarted">
			<div class="pull-left">
				Running...
         <i class="fa fa-circle-o-notch fa-spin fa-2x green fa-fw" aria-hidden="true"></i>
			</div>
	  </div>
	</div>

	<div class="test-labels">
		<div class="status__title test__status__frame">
		  Status
		</div>
		<div class="flex-auto test_functions">
		  Test Title
		</div>
		<div class="flex-initial time_stats">
		  Time (minutes)
		</div>
		<div class="flex-initial time_stats">
		  Date Discovered
		</div>
        <div class="flex-none accordion-flex">
		</div>
	</div>

	<div class="test-container">

		<div class="empty__state vertical__center_empty_state_discovery" ng-show="!isStarted && !waitingOnTests && tests.length==0">
			<div>
        <h2>Collect your tests by first running a Discovery.</h2>
      </div>
	    <div>
        <button class="btn btn--primary btn-lg" ng-click="startDiscovery()">
          Start Discovery
        </button>
      </div>
		</div>
    <div class="empty__state vertical__center_empty_state_busy" ng-if="(isStarted && tests.length==0) || waitingOnTests">
      <div style="text-align:center; margin: 0px auto;">
        <i class="fa fa-circle-o-notch fa-spin fa-3x green fa-fw" aria-hidden="true"></i>
				<br><br><br>
				<h2>Your tests are loading. Please stand by.</h2>
				<p class="empty__state__p">This process may take a while. You may want to leave this window open and go grab a coffee.<br><br>Please contact <a href="mailto:support@qanairy.com?subject=Excessive%20Load%20Times">support@qanairy.com</a> if this message is still active after 24 hrs.<br>If you would like to see this run faster contact us about a paid subscription.</p>
      </div>
    </div>

    <div class="test" ng-repeat="test in (filteredTests = tests) | filter:searchText | orderBy:'lastRunTimestamp' track by test.key " ng-show="tests.length>0">

			<div class="test__profile vertical__left__profile" ng-click="setTestIndex($index);visible_tab='nodedata'+$index">
			  <div class="test__status test__profile_stretch flex-none text--shadow" >
			   	<div class="row test__status__frame" id="{{'test'+$index+'_status'}}">
						<div class="col-xs-12 test__status" ng-show="test.waitingOnStatusChange">
							<i class="fa fa-circle-o-notch fa-spin fa-3x green fa-fw" aria-hidden="true"></i>
						</div>
					 	<div class="col-xs-6 status-passing btn--green discovery_status discovery_status_border" ng-show="!test.waitingOnStatusChange" ng-click="updateCorrectness(test, true, $index)">
						 	<div class="" >
								Passing
								<br />
								<i class="fa fa-check discovery--status--symbol white"
							   	 style="{{test.correct ? 'color:green' : 'color:#bfbfbf'}}"></i>
							</div>
						</div>
						<div class="discovery_status status-failing col-xs-6 btn--red " ng-show="!test.waitingOnStatusChange" ng-click="updateCorrectness(test, false, $index)">
							<div class="" >
									Failing
								<br />
								<i  class="fa fa-times discovery--status--symbol white"
									style="{{!test.correct && test.correct != null ? 'color:red' : 'color:#bfbfbf'}}"></i>
							</div>
						</div>
				  </div>
			  </div>

        <div class="flex-auto test_functions test__profile_stretch" ng-click="toggleTestDataVisibility(test, $index)" ng-if="!test.show_test_name_edit_field">
					<div class="" ng-show="!test.show_test_name_edit_field">
						<h4>
              {{test.name || "Test #"+($index+1)}}
            </h4>
						<i class="fa fa-pencil edithover" ng-click="test.show_test_name_edit_field = true" ></i>
					</div>
				</div>
        <div class="test_name flex-auto time_stats test__profile_stretch" ng-if="test.show_test_name_edit_field">
					<div class="row">
						<div class="flex-auto fifteen_left">
							<div class="">
								<input class="form-control title__edit" type="text" ng-model="new_name" ng-value="test.name" ng-trim="false"/>
							</div>
						</div>
						<div class="flex-none test_name_edit fifteen_right">
							<div class="title__edit__buttons btn--secondary" ng-click="cancelEditingTestName(test)" ng-show="!test.show_waiting_icon">Cancel</div><div class="title__edit__buttons btn--primary " ng-click="setTestName(test, new_name)" ng-show="!test.show_waiting_icon">Save</div>
							<div class="" ng-show="test.show_waiting_icon">
								<i class="fa fa-circle-notch fa-spin fa-2x green fa-fw"  aria-hidden="true"></i>
							</div>
						</div>
					</div>
				</div>
			  <div class="flex-initial time_stats test__profile_stretch" ng-click="toggleTestDataVisibility(test, $index)">
					{{test.runTime | date: 'm'}}:{{test.runTime | date: 'ss'}} m
			  </div>
			  <div class="flex-initial time_stats test__profile_stretch" ng-click="toggleTestDataVisibility(test, $index)">
					{{( test.lastRunTimestamp | date : 'MM/dd/yy h:mm a')  || "Unknown"}}
			  </div>
        <div class="flex-none accordion-flex test__profile_stretch" ng-click="toggleTestDataVisibility(test, $index)">
          <div class="accordion" aria-label="open/close accordion">
            <i class="fa fa-2x" ng-class="test.visible ? 'fa-angle-down' : 'fa-angle-right'" ></i>
          </div>
        </div>
			 </div>
	     <div class="row no-gutter test__dropdown" ng-show="test.visible"  >
				 <div class="col-sm-12">
						<div class="tabs tabs-style-linemove">
							<nav class="path_tabs">
								<ul>
									<li class="tabs-style" ng-click="visible_test_nav1='section-linemove-1'" ng-class="visible_test_nav1=='section-linemove-1' ? 'tabs-style_active' : ''"><h5><i class="fa test_tab_icons fa-map-signs"/>&nbsp;  Path</h5></li>
									<li class="tabs-style" ng-click="visible_test_nav1='section-linemove-2'" ng-class="visible_test_nav1=='section-linemove-2' ? 'tabs-style_active' : ''"><h5><i class="fa test_tab_icons fa-object-group"/>&nbsp;  Groups</h5></li>
								</ul>
							</nav>
							<div class="content-wrap">
								<div id="section-linemove-1" ng-if="visible_test_nav1=='section-linemove-1'">
									<div class="col-xs-12 test__path vertical__left__int" ng-click="visible_tab='nodedata'+$index" id="{{'test'+$index+'_data'}}">
                    <div class="node-group" ng-repeat="group_start_idx in getPathIterations(test.path.path.length)"
                          ng-class="current_group_idx[test_idx]==group_start_idx && !test.result.visible ? 'active' : ''"
                          ng-click="setCurrentGroupIdx(group_start_idx);test.result.visible=false;" >
  										<div ng-repeat="node in test.path.path | limitTo:3:group_start_idx track by $index" class="path-node-container vertical__center__int" tooltip-placement="top">
  											<div ng-if="node.browser_screenshots[default_browser]" class="path-page path-node"  >
  												<img src="{{node.browser_screenshots[default_browser]}}" class="path-node-image"/>
  											</div>
  											<div ng-if="node.type == 'PageElement'" class="path-node path-element vertical__center__int" tooltip-placement="top">
  												<span class="" >
  													{{node.name}}
  												</span>
  											</div>
  											<div ng-if="node.type == 'Action'" class="path-node path-action vertical__center__int" tooltip-placement="top">
  												<span ng-if="node.name=='click'" class="vertical__center__int">
  												<i class="fa fa-mouse-pointer fa-2x"></i>
  												</span>
  												<span ng-if="node.name=='doubleClick'" class="vertical__center__int">
  														<i class="fa fa-mouse-pointer fa-2x"></i>
  														<div class=”doubleclick” >
  																x2
  														</div>
  												</span>
  												<span ng-if="node.name=='mouseover'" class="vertical__center__int">
  														<i class="fa fa-hand-pointer-o fa-2x"></i>
  												</span>
  												<span ng-if="node.name=='scroll'" class="vertical__center__int">
  														<i class="fa fa-arrows-v fa-2x"></i>
  												</span>
  												<span ng-if="node.name=='sendKeys'" class="vertical__center__int">
  														<i class="fa fa-i-cursor fa-2x"></i>
  												</span>
  											</div>
  											<div class="path-bar">
  											</div>
  										</div>
                    </div>
										<div class="node-group path-node-container vertical__center__int" ng-click="test.result.visible=true" >
											<div ng-if="test.path.path.length != 1 && test.result.browser_screenshots[default_browser]" class="path-page path-node">
												<img src="{{test.result.browser_screenshots[default_browser]}}" class="path-node-image" tooltip-placement="top"/>
											</div>
										</div>
									</div>

									<div class="col-xs-12 test__data test_dropdown_bottom_shadow"  ng-if="!test.result.visible && test.path.path.length > 1">
										<div class="row path__data">
											<div class="col-xs-4">
													<div class="row node__data" id="{{'nodedata'+$index}}" ng-show="visible_tab=='nodedata'+$index">
															<div class="col-sm-12">
																<div class="row">
																	<div class="page__image col-xs-6">
																		<h5 class="screenshots">Page</h5>
																		<img type="button" class="path-node-image"
																						data-toggle="modal" data-target="#exampleModal"
																						src="{{test.path.path[current_group_idx[$index]].browser_screenshots[default_browser]}}" class="path-node-image"
																						ng-click="openPageModal(test.path.path[current_group_idx[$index]])" />
																	</div>
																	<div class="element__image col-xs-6">
																		<h5 class="screenshots">
																			Element</h5>
																		<img type="button" class="path-node-image"
																						data-toggle="modal" data-target="#exampleModal"
																						src="{{test.path.path[current_group_idx[$index]+1].screenshot}}" class="path-node-image"/>
																	</div>
																</div>
															</div>
													</div>
												</div>
											<div class="col-sm-8">
												<div class="tabs tabs-style-linemove">
													<nav>
														<ul>
															<li class="tabs-style" ng-click="visible_test_nav2='section-linemove-1'" ng-class="visible_test_nav2=='section-linemove-1' ? 'tabs-style_active' : ''"><h5>Info</h5></li>
															<li class="tabs-style" ng-click="visible_test_nav2='section-linemove-2'" ng-class="visible_test_nav2=='section-linemove-2' ? 'tabs-style_active' : ''"><h5>Attributes</h5></li>
															<li class="tabs-style" ng-click="visible_test_nav2='section-linemove-3'" ng-class="visible_test_nav2=='section-linemove-3' ? 'tabs-style_active' : ''"><h5>CSS</h5></li>
														</ul>
													</nav>
													<div class="content-wrap element-tabs">
														<div id="section-linemove-1" ng-if="visible_test_nav2=='section-linemove-1'">
															<div class="col-xs-12">
																<div class="key--value">
																	<div class="data__key">
																	 URL
																	</div>
																	<div class="data__value">
																	 <a href="{{test.path.path[current_group_idx[$index]].url}}" target="_blank">
                                     {{test.path.path[current_group_idx[$index]].url}}
                                   </a>
																	</div>
																</div>
															</div>
															<div class="col-xs-12">
																<div class="key--value">
																	<div class="data__key">
																	 Xpath
																	</div>
																	<div class="data__value">
																	 {{test.path.path[current_group_idx[$index]+1].xpath}}
																	</div>
																</div>
															</div>
															<div class="col-xs-12">
																<div class="key--value">
																	<div class="data__key">
																	 Action
																	</div>
																	<div class="data__value">
																	 -  {{test.path.path[current_group_idx[$index]+2].name != 'sendKeys' ? test.path.path[current_group_idx[$index]+2].name : 'Type'}}
																	</div>
																</div>
															</div>
															<div class="col-xs-12">
																<div class="key--value" ng-show="test.path.path[current_group_idx[$index]+2].value || test.path.path[current_group_idx[$index]+2].name=='sendKeys'">
																		<div class="data__key">
																				Text Input
																		</div>
																		<div class="data__value">
																				{{test.path.path[current_group_idx[$index]+2].value}}
																		</div>
																</div>
															</div>
															<div class="col-xs-12">
																<div class="key--value">
																	<div class="data__key">
																	 Element Type
																	</div>
																	<div class="data__value">
																	 {{test.path.path[current_group_idx[$index]+1].name}}
																	</div>
																</div>
															</div>
															<div class="col-xs-12" ng-if="test.path.path[current_group_idx[$index]+1].name=='a'">
																<div class="key--value">
																	<div class="data__key">
																	 Element Link
																	</div>
																	<div class="data__value">
                                    {{test.path.path[current_group_idx[$index]+1].attributes[0].vals[0]}}
																	</div>
																</div>
															</div>
															<div class="col-xs-12">
																<div class="key--value">
																	<div class="data__key">
																		Text
																	</div>
																	<div class="data__value">
																		{{test.path.path[current_group_idx[$index]+1].text}}
																	</div>
																</div>
															</div>
														</div>
														<div id="section-linemove-2" ng-if="visible_test_nav2=='section-linemove-2'">
															<div class="col-xs-12">
																<div class="key--value">
																		<div class="data__key">
																				Attributes
																		</div>
																		<div class="row attribute__data__value" ng-repeat="attribute in test.path.path[current_group_idx[$index]+1].attributes track by attribute.key">
																				<div class="col-sm-5 attribute__key">
																						{{attribute.name}}
																				</div>
																				<div class="attribute_value col-sm-7 pull-right">
																					<div class="row" ng-repeat="value in attribute.vals track by $index">
																						<div class="col-sm-12" style="text-align:right">
																							{{value}}
																						</div>
																					</div>
																				</div>
																		</div>
																</div>
															</div>
														</div>
														<div id="section-linemove-3" ng-if="visible_test_nav2=='section-linemove-3'">
																<div class="col-xs-12">
																<div class="key--value">
																	<div class="data__key">
																		CSS
																	</div>
                                  <div class="data__value">
                                    width: {{test.path.path[current_group_idx[$index]+1].cssValues['width']}}
                                  </div>
                                  <div class="data__value">
                                    height: {{test.path.path[current_group_idx[$index]+1].cssValues['height']}}
                                  </div>
                                  <div class="data__value">
                                    font-family: {{test.path.path[current_group_idx[$index]+1].cssValues['font-family']}}
                                  </div>
                                  <div class="data__value">
                                    color:
                                    <span style="background-color:{{test.path.path[current_group_idx[$index]+1].cssValues['color']}}">
                                      {{test.path.path[current_group_idx[$index]+1].cssValues['color']}}
                                    </span>
                                  </div>
                                  <div class="data__value">
                                    position: {{test.path.path[current_group_idx[$index]+1].cssValues['position']}}
                                  </div>
																</div>
															</div>
														</div>
													</div><!-- /content -->
												</div><!-- /tabs -->
											</div>
										</div>
									</div>

										<div class="col-xs-12 test__data test_dropdown_bottom_shadow" ng-if="test.result.visible || test.path.path.length == 1">
										<div class="row path__data">
											<div class="col-xs-4">
													<div class="row node__data" id="{{'nodedata'+$index}}">
															<div class="col-sm-12">
																<div class="row">
																	<div class="page__image col-xs-12">
																		<h5 class="screenshots">Page</h5>
																		<img type="button" class="path-node-image"
																						data-toggle="modal" data-target="#exampleModal"
																						src="{{test.result.browser_screenshots[default_browser]}}" class="path-node-image"
																						ng-click="openPageModal(test.result)" />
																	</div>
																</div>
															</div>
													</div>
												</div>
											<div class="col-sm-8">
												<div class="tabs solo-page tabs-style-linemove">
													<nav>
														<ul>
															<li class="tabs-style" ng-click="visible_test_nav2='section-linemove-1'" ng-class="visible_test_nav2=='section-linemove-1' ? 'tabs-style_active' : ''"><h5>Info</h5></li>
														</ul>
													</nav>
													<div class="content-wrap element-tabs">
														<div id="section-linemove-1">
															<div class="col-xs-12">
																<div class="key--value">
																	<div class="data__key">
																	 URL
																	</div>
																	<div class="data__value">
																	 <a href="{{test.result.url}}">
                                     {{test.result.url}}
                                   </a>
																	</div>
																</div>
															</div>
														</div>
													</div><!-- /content -->
												</div><!-- /tabs -->
											</div>
										</div>
									</div>
								</div>
								<div id="section-linemove-2" ng-if="visible_test_nav1=='section-linemove-2'">
									<div class="col-xs-12 test__groups test_dropdown_bottom_shadow">
										<div class="row">
											<div class="col-sm-12 " id="group_label">
													<h5>Groups</h5>
											</div>
											<div class="col-sm-12 ">
												<div class="input-group groups_input_padding">
													<input type="text" class="form-control pull-right" ng-model="group.name" placeholder="Smoke, Login Form, etc." aria-describedby="basic-addon2" maxlength="20">
													<span class="input-group-addon btn--gray" ng-click="addGroup(test, group)" id="basic-addon2">
															<i class="fa fa-plus"></i>
													</span>
												</div>
											</div>
											<div class="col-sm-12">
													<div class="group__tag"
																	 ng-repeat="group in test.groups track by group.key"
																	 data-toggle="tooltip"
																	 data-placement="top"
																	 title="{{group.description}}">
															{{group.name}}
															<span ng-click="removeGroup(test, group, $index)">
																	<i class="remove__group fa fa-times"></i>
															</span>
													</div>
											</div>
										</div>
									</div>
								</div>
							</div><!-- /content -->
						</div><!-- /tabs -->
					</div>
      </div>
	</div>

  <onboarding-popover enabled="discoveryOnboardingEnabled" steps="discoveryOnboardingSteps" step-index="discoveryOnboardingIndex"></onboarding-popover>
  <onboarding-popover enabled="discoveryRunningOnboardingEnabled" steps="discoveryRunningOnboardingSteps" step-index="discoveryRunningOnboardingIndex"></onboarding-popover>
  <onboarding-popover enabled="discoveredTestOnboardingEnabled" steps="discoveredTestOnboardingSteps" step-index='discoveredTestOnboardingIndex'></onboarding-popover>
  <onboarding-popover enabled="testVerificationOnboardingEnabled" steps="testVerificationSteps" step-index='testVerificationOnboardingIndex'></onboarding-popover>
